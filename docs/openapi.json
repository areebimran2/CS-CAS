{
  "openapi": "3.1.0",
  "x-stoplight": {
    "id": "nfmlwn3mvsyt5"
  },
  "info": {
    "title": "NinjaAPI",
    "version": "1.0.0",
    "description": ""
  },
  "paths": {
    "/api/auth/login": {
      "post": {
        "operationId": "myauth_api_auth_base_login",
        "summary": "Login",
        "parameters": [],
        "responses": {
          "200": {
            "description": "The login verification context was successfully established.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginOut"
                },
                "examples": {
                  "No established device": {
                    "value": {
                      "id": "verif.R_g-hREvUPprZ8vRYuVHzQ",
                      "method": null
                    }
                  },
                  "Established device": {
                    "value": {
                      "id": "verif.R_g-hREvUPprZ8vRYuVHzQ",
                      "method": {
                        "name": "default",
                        "type": "PhoneDevice"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Common response for all operations that can return a `401` error indicating authentication is required.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/AUTHENTICATION_FAILED",
                  "title": "Invalid credentials",
                  "status": 401,
                  "detail": "Either email or password is invalid",
                  "instance": "/auth/login",
                  "errors": [
                    {
                      "field": "email"
                    },
                    {
                      "field": "password"
                    }
                  ]
                }
              }
            }
          },
          "422": {
            "description": "Schema validation for the request body failed.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/VALIDATION_FAILED",
                  "title": "Validation Failed",
                  "status": 422,
                  "detail": "One or more validation errors occurred.",
                  "instance": "/auth/login",
                  "errors": [
                    {
                      "field": "email",
                      "message": "value is not a valid email address: The part after the @-sign is not valid. It should have a period."
                    }
                  ]
                }
              }
            }
          }
        },
        "description": "Check if the given user credentials are valid, then establish a login verification context. The context ID along with the user's default 2FA method/device (if any) are returned.\n\nIf the user has not yet setup 2FA, then they must do so after this step by calling the appropriate 2FA setup endpoint (SMS default). Otherwise, they can proceed to verify 2FA using the returned method/device.\n\nSMS: OTP is sent through `/api/auth/2fa/sms/send` endpoint.  \nTOTP: OTP is generated through authenticator apps (e.g Google Authenticator).\n\nThis operation may fail for any of the following reasons:\n- The given credentials does not match an account (HTTP error `401`)\n- A schema validation error was indicated, i.e. missing field, or incorrect field format (HTTP error `422`)\n\n**Note**: This endpoint does NOT establish a login session. The session is only created after successful\n2FA verification.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginIn"
              },
              "examples": {
                "Sign-in": {
                  "value": {
                    "email": "user@example.com",
                    "password": "strong-password123"
                  }
                },
                "Remembered sign-in": {
                  "value": {
                    "email": "user@example.com",
                    "password": "strong-password123",
                    "remember_me": true
                  }
                }
              }
            }
          },
          "required": true,
          "description": "The credentials of the user for which a login verification context is to be established."
        },
        "x-stoplight": {
          "id": "gocc2l4ei0h94"
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "operationId": "myauth_api_auth_base_logout",
        "summary": "Logout",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "cookie",
            "name": "cscas-refresh",
            "description": "Refresh token stored in an HttpOnly cookie."
          }
        ],
        "responses": {
          "200": {
            "description": "The active session was successfully terminated.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                },
                "example": {
                  "message": "Logged-in session has been cleared successfully."
                }
              }
            },
            "headers": {
              "Set-Cookie": {
                "schema": {
                  "type": "string",
                  "example": "cscas-refresh=; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/"
                },
                "description": "Clears the refresh token cookie."
              }
            }
          }
        },
        "description": "Logout by terminating the active session and clearing the refresh token cookie.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {}
        }
      }
    },
    "/api/auth/refresh": {
      "post": {
        "operationId": "myauth_api_auth_base_refresh",
        "summary": "Refresh",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "cookie",
            "name": "cscas-refresh",
            "description": "Refresh token stored in an HttpOnly cookie."
          }
        ],
        "responses": {
          "200": {
            "description": "The active session was successfully refreshed.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenOut"
                }
              }
            },
            "headers": {
              "Set-Cookie": {
                "schema": {
                  "type": "string",
                  "example": "cscas-refresh=eyJh...; HttpOnly; Path=/;"
                },
                "description": "Sets the new rotated refresh token cookie."
              }
            }
          },
          "401": {
            "description": "Common response for all operations that can return a `401` error indicating authentication is required.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/AUTHENTICATION_FAILED",
                  "title": "Invalid refresh token",
                  "status": 401,
                  "detail": "Refresh token does not match the stored session data: old token reuse",
                  "instance": "/auth/refresh"
                }
              }
            }
          }
        },
        "description": "Check the validity of the refresh token in the cookie, then rotate it and use it to generate a new short-lived access token. The previous token is invalidated, and the server sends an updated `Set-Cookie` header to the client that contains the new `cscas-refresh`.\n\nThis operation may fail for any of the following reasons:\n- `cscas-refresh` is missing in the cookie or does not correspond to a refresh token issued by the system (HTTP error `401`)\n- There is no valid session that corresponds to the refresh token (HTTP error `401`)\n- There is a refresh token mismatch with the session context (HTTP error `401`)\n\nNote: the session context details are updated accordingly to actively maintain user session.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ]
      }
    },
    "/api/auth/password/forgot": {
      "post": {
        "operationId": "myauth_api_auth_base_forgot_password",
        "summary": "Forgot Password",
        "parameters": [],
        "responses": {
          "200": {
            "description": "If a corresponding account exists, A password reset link was successfully sent to the email.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                },
                "example": {
                  "message": "If an account with that email exists, a password reset link has been sent."
                }
              }
            }
          },
          "409": {
            "description": "Common response used when an input conflicts with existing data.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/RATE_LIMITED",
                  "title": "Password reset request error",
                  "status": 409,
                  "detail": "Password reset link has been sent recently. Please check the given email or try again later",
                  "instance": "/auth/password/forgot"
                }
              }
            }
          },
          "422": {
            "description": "Schema validation for the request body failed.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/VALIDATION_FAILED",
                  "title": "Validation Failed",
                  "status": 422,
                  "detail": "One or more validation errors occurred.",
                  "instance": "/auth/password/forgot",
                  "errors": [
                    {
                      "field": "email",
                      "message": "Field required"
                    }
                  ]
                }
              }
            }
          }
        },
        "description": "Initiates the \"forgot password\" flow by requesting a password reset email. Additionally, establishes a password reset verification context that is used to maintain the reset token, and other user specific information. The context id is provided in the email, along with the token.\n\nThis operation may fail for any of the following reasons:\n- A password reset email has already been issued (HTTP error `409`)\n- A schema validation error was indicated, i.e. missing field, or incorrect field format (HTTP error `422`)",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ForgotPasswordIn"
              }
            }
          },
          "required": true,
          "description": "The email for which a password reset verification context is to be established, and a password reset email to be sent."
        }
      }
    },
    "/api/auth/password/reset": {
      "post": {
        "operationId": "myauth_api_auth_base_reset_password",
        "summary": "Reset Password",
        "parameters": [],
        "responses": {
          "200": {
            "description": "The password was successfully reset.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                },
                "example": {
                  "message": "Password has been reset successfully"
                }
              }
            }
          },
          "400": {
            "description": "Common response for all operations that can return a `400` error.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/VALIDATION_FAILED",
                  "title": "Password validation error",
                  "status": 400,
                  "detail": "The provided new password does not meet the password policy requirements",
                  "instance": "/auth/password/reset",
                  "errors": [
                    {
                      "field": "password",
                      "message": "Password is too short."
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Common response for all operations that can return a `401` error indicating authentication is required.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/AUTHENTICATION_FAILED",
                  "title": "Password reset failed",
                  "status": 401,
                  "detail": "Error encountered when verifying password reset token",
                  "instance": "/auth/password/reset",
                  "errors": [
                    {
                      "field": "token",
                      "message": "Invalid or expired token"
                    }
                  ]
                }
              }
            }
          },
          "422": {
            "description": "Schema validation for the request body failed.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorModel"
                },
                "example": {
                  "type": "https://api.cscas/errors/VALIDATION_FAILED",
                  "title": "Validation Failed",
                  "status": 422,
                  "detail": "One or more validation errors occurred.",
                  "instance": "/auth/password/forgot",
                  "errors": [
                    {
                      "field": "id",
                      "message": "Does not match expected verification context id pattern."
                    }
                  ]
                }
              }
            }
          }
        },
        "description": "Completes the \"forgot password\" flow by validating the token sent in the password reset email from `/api/auth/password/forgot` and setting a new password for the user.\n\nThis operation may fail for any of the following reasons:\n- The new password fails to meet strong policy requirements (HTTP error `400`)\n- There is no valid context with the given context id (HTTP error `401`)\n- The token given does not match the password reset context, token validation failed (HTTP error `401`)\n- A schema validation error was indicated, i.e. missing field, or incorrect field format (HTTP error `422`)",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResetPasswordIn"
              }
            }
          },
          "required": true,
          "description": "The verification details provided in the password reset email, and the new password."
        }
      }
    },
    "/api/auth/2fa/totp/setup": {
      "post": {
        "operationId": "myauth_api_auth_tfa_setup_tfa_totp",
        "summary": "Setup Tfa Totp",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TFASetupTOTPOut"
                }
              }
            }
          }
        },
        "description": "Initiate TOTP 2FA setup for the user by generating a TOTP secret and OTP URI.\n\nThe OTP URI should be used to generate a QR code for the user to scan with their authenticator app.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TFASetupTOTPIn"
              }
            }
          },
          "required": true,
          "description": "The login verification context from `api/auth/login`."
        }
      }
    },
    "/api/auth/2fa/totp/confirm": {
      "post": {
        "operationId": "myauth_api_auth_tfa_confirm_tfa_totp",
        "summary": "Confirm Tfa Totp",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TFAConfirmOut"
                }
              }
            }
          }
        },
        "description": "Confirm TOTP 2FA setup by verifying the provided passcode against the TOTP secret.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TFAConfirmTOTPIn"
              }
            }
          },
          "required": true
        }
      }
    },
    "/api/auth/2fa/sms/send": {
      "post": {
        "operationId": "myauth_api_auth_tfa_send_2fa_sms",
        "summary": "Send 2Fa Sms",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TFAConfirmOut"
                }
              }
            }
          }
        },
        "description": "Send an OTP SMS to the user's registered phone number for SMS 2FA verification.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TFASetupSMSIn"
              }
            }
          },
          "required": true,
          "description": "The login verification context from `api/auth/login`."
        }
      }
    },
    "/api/auth/2fa/verify": {
      "post": {
        "operationId": "myauth_api_auth_tfa_verify_2fa",
        "summary": "Verify 2Fa",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "login"
                  ],
                  "title": "UnAuthPurpose",
                  "type": "string"
                }
              ],
              "default": "login"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenOut"
                }
              }
            }
          }
        },
        "description": "Verify the provided 2FA passcode and establish a user session upon successful verification.",
        "tags": [
          "A1. Login / 2FA / Forgotten Password"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TFAVerifyIn"
              }
            }
          },
          "required": true
        }
      }
    },
    "/api/me/": {
      "get": {
        "operationId": "myauth_api_me_base_profile",
        "summary": "Profile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileSchema"
                }
              }
            }
          }
        },
        "description": "Retrieve the authenticated user's profile information, including preferences.",
        "tags": [
          "A2. My Profile"
        ],
        "security": [
          {
            "JWTAuth": []
          }
        ]
      },
      "put": {
        "operationId": "myauth_api_me_base_update_profile",
        "summary": "Update Profile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileSchema"
                }
              }
            }
          }
        },
        "description": "Update the authenticated user's profile information, including preferences.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserProfileUpdateSchema"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/security/sms/send": {
      "post": {
        "operationId": "myauth_api_me_base_secure_action",
        "summary": "Secure Action",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Send an OTP SMS to the user's registered phone number for security-sensitive actions.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SecuritySetupIn"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/phone/verify-old": {
      "post": {
        "operationId": "myauth_api_me_base_verify_old_phone",
        "summary": "Verify Old Phone",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "verify-old-phone"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Verify the user's old phone number as stage 1 of the phone number change process.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VerifySchema"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/phone/change": {
      "post": {
        "operationId": "myauth_api_me_base_change_phone",
        "summary": "Change Phone",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "verify-new-phone"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Initiate stage 2 of the phone number change process by sending an OTP to the new phone number.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePhoneIn"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/phone/verify-new": {
      "post": {
        "operationId": "myauth_api_me_base_verify_new_phone",
        "summary": "Verify New Phone",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "verify-new-phone"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Verify the user's new phone number and update it in the system.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VerifySchema"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/password/change": {
      "post": {
        "operationId": "myauth_api_me_base_password_change",
        "summary": "Password Change",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "change-password"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Change the authenticated user's password after verifying the current password and OTP.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePasswordIn"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/email/change": {
      "post": {
        "operationId": "myauth_api_me_base_email_change",
        "summary": "Email Change",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "change-email"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Change the authenticated user's email after verifying the OTP.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangeEmailIn"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    },
    "/api/me/tfa-method/change": {
      "post": {
        "operationId": "myauth_api_me_base_tfa_method_change",
        "summary": "Tfa Method Change",
        "parameters": [
          {
            "in": "query",
            "name": "purpose",
            "schema": {
              "allOf": [
                {
                  "enum": [
                    "verify-old-phone",
                    "verify-new-phone",
                    "change-email",
                    "change-password",
                    "change-tfa-method"
                  ],
                  "title": "AuthPurpose",
                  "type": "string"
                }
              ],
              "default": "change-tfa-method"
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageOut"
                }
              }
            }
          }
        },
        "description": "Change the authenticated user's two-factor authentication (TFA) method after verifying the OTP.",
        "tags": [
          "A2. My Profile"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangeTFAMethodIn"
              }
            }
          },
          "required": true
        },
        "security": [
          {
            "JWTAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "LoginOut": {
        "title": "LoginOut",
        "type": "object",
        "x-stoplight": {
          "id": "bzg4reijk5gko"
        },
        "examples": [],
        "properties": {
          "id": {
            "title": "Id",
            "type": "string",
            "pattern": "^verif\\.[A-Za-z0-9_-]{22}$",
            "description": "This id maps to the login verification context for the user which contains necessary information to establish a session. This id is required for subsequent steps of the login process."
          },
          "method": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/Method"
              },
              {
                "type": "null",
                "description": "The user has not yet set up an authentication device."
              }
            ],
            "description": "If the user has a verified authentication device, method will contain information corresponding to this device; otherwise, method is null."
          }
        },
        "required": [
          "id"
        ]
      },
      "Method": {
        "title": "Method",
        "type": "object",
        "x-stoplight": {
          "id": "4tkahzccsijo3"
        },
        "description": "The user's default authentication device.",
        "properties": {
          "name": {
            "title": "Name",
            "type": "string",
            "enum": [
              "default"
            ]
          },
          "type": {
            "title": "Type",
            "type": "string",
            "enum": [
              "PhoneDevice",
              "TOTPDevice"
            ]
          }
        },
        "required": [
          "name",
          "type"
        ]
      },
      "LoginIn": {
        "properties": {
          "email": {
            "format": "email",
            "title": "Email",
            "type": "string"
          },
          "password": {
            "title": "Password",
            "type": "string"
          },
          "remember_me": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "default": false,
            "title": "Remember Me",
            "description": "Establishes a longer session upon verification if set to True."
          }
        },
        "required": [
          "email",
          "password"
        ],
        "title": "LoginIn",
        "type": "object",
        "x-stoplight": {
          "id": "dv2ajl2bqw7hx"
        },
        "examples": []
      },
      "MessageOut": {
        "title": "MessageOut",
        "type": "object",
        "x-stoplight": {
          "id": "dcl2nu00xrjvt"
        },
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          }
        },
        "required": [
          "message"
        ],
        "examples": []
      },
      "TokenOut": {
        "title": "TokenOut",
        "type": "object",
        "x-stoplight": {
          "id": "spjw3hgk1yxdl"
        },
        "examples": [
          {
            "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY5NjM0MjcxLCJpYXQiOjE3Njk2MzMzNzEsImp0aSI6ImY2ZWEyZmFlMjc3ODRlMjQ5MTBlOTI3Y2I0ZmM5ODI1IiwidXNlcl9pZCI6ImM1MjhiZTNiLTE5M2EtNDNiYS1iMzZiLTBkODgwODk4NmVmMSIsInVpZCI6ImM1MjhiZTNiLTE5M2EtNDNiYS1iMzZiLTBkODgwODk4NmVmMSIsInNpZCI6InNlc3Npb24uMFQ1Sk54NlAxTWFsLXJhZjd3YW0zUSIsImF1ZCI6ImNzY2FzLWNsaWVudCIsImlzcyI6ImNzY2FzLWFwaSJ9.T701B4TMqedfrqyEJhk18GAy9I7kbSVF12RiujfuY_I"
          }
        ],
        "properties": {
          "access": {
            "title": "Access",
            "type": "string",
            "description": "Short-lived JWT used to authenticate API requests. Sent in the `Authorization` header as `Bearer <access>`."
          }
        },
        "required": [
          "access"
        ]
      },
      "ForgotPasswordIn": {
        "properties": {
          "email": {
            "format": "email",
            "title": "Email",
            "type": "string"
          }
        },
        "required": [
          "email"
        ],
        "title": "ForgotPasswordIn",
        "type": "object",
        "x-stoplight": {
          "id": "hjqn62oj8do6a"
        }
      },
      "ResetPasswordIn": {
        "title": "ResetPasswordIn",
        "type": "object",
        "x-stoplight": {
          "id": "ew1anbgkvguec"
        },
        "examples": [
          {
            "id": "verif.NMJzvfAcNnAHlGBTZiiSWA",
            "token": "d36138-f6a9d4cc4dae8ed5dcab62142646c118",
            "password": "strong-password123"
          }
        ],
        "properties": {
          "id": {
            "title": "Id",
            "type": "string",
            "pattern": "^verif\\.[A-Za-z0-9_-]{22}$",
            "description": "This id maps to the password reset context. It is provided in the email sent by `/api/auth/password/forgot` and is used to validate the reset token."
          },
          "token": {
            "title": "Token",
            "type": "string",
            "pattern": "^(?P<ts_b36>[0-9a-z]{1,6})-(?P<hash>[0-9a-f]{32})$",
            "description": "Expiring password reset token provided in the email sent by `/api/auth/password/forgot`. "
          },
          "password": {
            "title": "Password",
            "type": "string"
          }
        },
        "required": [
          "id",
          "token",
          "password"
        ]
      },
      "TFASetupTOTPOut": {
        "properties": {
          "id": {
            "title": "Id",
            "type": "string"
          },
          "otpauth_url": {
            "title": "Otpauth Url",
            "type": "string"
          }
        },
        "required": [
          "id",
          "otpauth_url"
        ],
        "title": "TFASetupTOTPOut",
        "type": "object",
        "x-stoplight": {
          "id": "7oh8ak317eeq6"
        }
      },
      "TFASetupTOTPIn": {
        "title": "TFASetupTOTPIn",
        "type": "object",
        "x-stoplight": {
          "id": "9qj4z56f2xjn9"
        },
        "properties": {
          "id": {
            "title": "Id",
            "type": "string",
            "pattern": "^verif\\.[A-Za-z0-9_-]{22}$",
            "description": "A login verification context id."
          }
        },
        "required": [
          "id"
        ],
        "examples": [
          {
            "id": "verif.R_g-hREvUPprZ8vRYuVHzQ"
          }
        ]
      },
      "TFAConfirmOut": {
        "properties": {
          "id": {
            "title": "Id",
            "type": "string"
          },
          "message": {
            "title": "Message",
            "type": "string"
          }
        },
        "required": [
          "id",
          "message"
        ],
        "title": "TFAConfirmOut",
        "type": "object",
        "x-stoplight": {
          "id": "l6zx09ebxdufs"
        }
      },
      "TFAConfirmTOTPIn": {
        "properties": {
          "id": {
            "title": "Id",
            "type": "string"
          },
          "url": {
            "title": "Url",
            "type": "string"
          },
          "passcode": {
            "title": "Passcode",
            "type": "string"
          }
        },
        "required": [
          "id",
          "url",
          "passcode"
        ],
        "title": "TFAConfirmTOTPIn",
        "type": "object",
        "x-stoplight": {
          "id": "ef9n3p2asoimz"
        }
      },
      "UnAuthPurpose": {
        "enum": [
          "login"
        ],
        "title": "UnAuthPurpose",
        "type": "string",
        "x-stoplight": {
          "id": "mklvrtkqcu2e0"
        }
      },
      "TFASetupSMSIn": {
        "title": "TFASetupSMSIn",
        "type": "object",
        "x-stoplight": {
          "id": "9gdl3iv229oxw"
        },
        "examples": [
          {
            "id": "verif.R_g-hREvUPprZ8vRYuVHzQ"
          }
        ],
        "properties": {
          "id": {
            "title": "Id",
            "type": "string",
            "description": "A login verification context id.",
            "pattern": "^verif\\.[A-Za-z0-9_-]{22}$"
          }
        },
        "required": [
          "id"
        ]
      },
      "TFAVerifyIn": {
        "properties": {
          "id": {
            "title": "Id",
            "type": "string"
          },
          "passcode": {
            "title": "Passcode",
            "type": "string"
          }
        },
        "required": [
          "id",
          "passcode"
        ],
        "title": "TFAVerifyIn",
        "type": "object",
        "x-stoplight": {
          "id": "8urq7dsp5naoj"
        }
      },
      "UserPrefSchema": {
        "properties": {
          "opt_in_enabled": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Opt In Enabled"
          },
          "notify_cabin_avail": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notify Cabin Avail"
          },
          "notify_flash_sale": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notify Flash Sale"
          },
          "notify_release_request": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notify Release Request"
          },
          "fx_mode": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Fx Mode"
          }
        },
        "title": "UserPrefSchema",
        "type": "object",
        "x-stoplight": {
          "id": "846oy9ad1slv7"
        }
      },
      "UserProfileSchema": {
        "properties": {
          "preferences": {
            "$ref": "#/components/schemas/UserPrefSchema"
          },
          "first_name": {
            "title": "First Name",
            "type": "string"
          },
          "middle_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Middle Name"
          },
          "last_name": {
            "title": "Last Name",
            "type": "string"
          },
          "designation": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Designation"
          },
          "email": {
            "maxLength": 254,
            "title": "Email",
            "type": "string"
          },
          "phone": {
            "maxLength": 128,
            "title": "Phone",
            "type": "string"
          },
          "twofa_method": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Twofa Method"
          },
          "twofa_enabled": {
            "title": "Twofa Enabled",
            "type": "boolean"
          }
        },
        "required": [
          "preferences",
          "first_name",
          "last_name",
          "email",
          "phone",
          "twofa_enabled"
        ],
        "title": "UserProfileSchema",
        "type": "object",
        "x-stoplight": {
          "id": "xvgfpr0ti2220"
        }
      },
      "UserProfileUpdateSchema": {
        "properties": {
          "first_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "First Name"
          },
          "middle_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Middle Name"
          },
          "last_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Last Name"
          },
          "designation": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Designation"
          },
          "preferences": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/UserPrefSchema"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "title": "UserProfileUpdateSchema",
        "type": "object",
        "x-stoplight": {
          "id": "7slxcl76eew15"
        }
      },
      "AuthPurpose": {
        "enum": [
          "verify-old-phone",
          "verify-new-phone",
          "change-email",
          "change-password",
          "change-tfa-method"
        ],
        "title": "AuthPurpose",
        "type": "string",
        "x-stoplight": {
          "id": "shycfkxd92z9v"
        }
      },
      "SecuritySetupIn": {
        "properties": {
          "purpose": {
            "$ref": "#/components/schemas/AuthPurpose"
          }
        },
        "required": [
          "purpose"
        ],
        "title": "SecuritySetupIn",
        "type": "object",
        "x-stoplight": {
          "id": "9mqiw1t8qt01x"
        }
      },
      "VerifySchema": {
        "properties": {
          "passcode": {
            "title": "Passcode",
            "type": "string"
          }
        },
        "required": [
          "passcode"
        ],
        "title": "VerifySchema",
        "type": "object",
        "x-stoplight": {
          "id": "yldytoyl4wqqp"
        }
      },
      "ChangePhoneIn": {
        "properties": {
          "phone": {
            "format": "phone",
            "title": "Phone",
            "type": "string"
          }
        },
        "required": [
          "phone"
        ],
        "title": "ChangePhoneIn",
        "type": "object",
        "x-stoplight": {
          "id": "r7gu927i5gvtk"
        }
      },
      "ChangePasswordIn": {
        "properties": {
          "passcode": {
            "title": "Passcode",
            "type": "string"
          },
          "password": {
            "title": "Password",
            "type": "string"
          },
          "confirm": {
            "title": "Confirm",
            "type": "string"
          }
        },
        "required": [
          "passcode",
          "password",
          "confirm"
        ],
        "title": "ChangePasswordIn",
        "type": "object",
        "x-stoplight": {
          "id": "1cw4r3r0vf8dp"
        }
      },
      "ChangeEmailIn": {
        "properties": {
          "passcode": {
            "title": "Passcode",
            "type": "string"
          },
          "email": {
            "format": "email",
            "title": "Email",
            "type": "string"
          }
        },
        "required": [
          "passcode",
          "email"
        ],
        "title": "ChangeEmailIn",
        "type": "object",
        "x-stoplight": {
          "id": "2r5qi5sbep2w0"
        }
      },
      "ChangeTFAMethodIn": {
        "properties": {
          "passcode": {
            "title": "Passcode",
            "type": "string"
          },
          "method": {
            "$ref": "#/components/schemas/TFAMethod"
          }
        },
        "required": [
          "passcode",
          "method"
        ],
        "title": "ChangeTFAMethodIn",
        "type": "object",
        "x-stoplight": {
          "id": "nm43bu9vuxh2p"
        }
      },
      "TFAMethod": {
        "enum": [
          "sms",
          "totp"
        ],
        "title": "TFAMethod",
        "type": "string",
        "x-stoplight": {
          "id": "fo8nr6igiy3dl"
        }
      },
      "ErrorModel": {
        "x-stoplight": {
          "id": "k5ilpen4kcva1"
        },
        "title": "ErrorModel",
        "type": "object",
        "properties": {
          "type": {
            "title": "Type",
            "type": "string",
            "x-stoplight": {
              "id": "e37g8302z7nka"
            },
            "description": "A stable identifier for the error code."
          },
          "title": {
            "title": "Title",
            "type": "string",
            "x-stoplight": {
              "id": "hebwprlvl5d9f"
            },
            "description": "A short, human-readable summary of the problem type."
          },
          "status": {
            "title": "Status",
            "type": "integer",
            "x-stoplight": {
              "id": "f162mvo8nvv4r"
            },
            "description": "The HTTP status code."
          },
          "detail": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Detail",
            "x-stoplight": {
              "id": "51tv8i24g704g"
            },
            "description": "A human-readable explanation specific to this occurrence of the problem."
          },
          "instance": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Instance",
            "x-stoplight": {
              "id": "okcort7o3hm8r"
            },
            "description": "The request path that identifies the specific occurrence of the problem."
          },
          "errors": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "object"
                }
              },
              {
                "type": "null"
              }
            ],
            "title": "Errors",
            "x-stoplight": {
              "id": "5l1k3ecbypk6z"
            },
            "description": "An optional list of field-level issues."
          }
        },
        "required": [
          "type",
          "title",
          "status"
        ]
      }
    },
    "securitySchemes": {
      "JWTAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "servers": [],
  "tags": [
    {
      "name": "A1. Login / 2FA / Forgotten Password",
      "description": "\nRelates all endpoints pertaining to sign-in and logged-in user sessions. This includes login flow,\nreset password flow, and session authentication.\n\nNote that a verification context is a cached record of relevant user information that is used to establish their\nsession once verification is complete.\n\nThe entire login flow is as follows:\n\n1. email+password+optional remember_me  `/api/auth/login`: returns verification context id + default 2FA method/device.\n    If the method is None, the user has not setup a 2FA device yet.\n    - A user may setup a TOTP device or SMS device (the device must match their `twofa_method`, i.e a user with\n          `twofa_method='sms'` cannot setup a TOTP device)\n        - SMS setup through `/api/auth/2fa/sms/send`\n2. context id+purpose (login/reset)  /api/auth/2fa/sms/send: sends OTP\n3. passcode+purpose (login/reset)  /api/auth/2fa/verify: establishes login session\n"
    }
  ],
  "x-tagGroups": [
    {
      "name": "A. Authentication & Profile",
      "tags": [
        "A1. Login / 2FA / Forgotten Password",
        "A2. My Profile"
      ]
    }
  ]
}